echo $(date +"%Y-%m-%d %H:%M:%S") $$ $PPID common/profile >> $HOME/.dot_log

# This gets loaded as the only startup file prior to the gnome-session

# Initialise DOTFILES
[[ -f $HOME/.dot ]] && source $HOME/.dot

# Check if we've been loaded before
if [[ -n $DOTFILES_PROFILE ]]
then
    # Check timestamp of ourself and only carry on if newer
    PROFILE_TS=$(stat -c %Y $DOTFILES/common/profile)
    if [[ $PROFILE_TS -lt $DOTFILES_PROFILE ]]
    then
	return
    fi

    DOTFILES_RELOAD=1
else
    DOTFILES_RELOAD=0
fi

export DOTFILES_PROFILE=$(date +%s)

#################
# Path functions.
#################

# Path add function
# If there is a second parameter then prepend instead of append
pathadd() {
    if [ -d "$1" ] && [[ ":$PATH:" != *":$1:"* ]]; then
	if [ -z "$2" ]; then
            PATH="${PATH:+"$PATH:"}$1"
	else
	    PATH="$1${PATH:+":$PATH"}"
	fi
    fi
}

# LD_LIBRARY_PATH
ldpathadd() {
    if [ -d "$1" ] && [[ ":$LD_LIBRARY_PATH:" != *":$1:"* ]]; then
        LD_LIBRARY_PATH="${LD_LIBRARY_PATH:+"$LD_LIBRARY_PATH:"}$1"
    fi
}

# MANPATH
manpathadd() {
    if [ -d "$1" ] && [[ ":$MANPATH:" != *":$1:"* ]]; then
        MANPATH="${MANPATH:+"$MANPATH:"}$1"
    fi
}

# Add RVM to PATH for scripting
pathadd ~/.rvm/bin

# Library path
ldpathadd /usr/local/lib

# Provisioning folder for RVM
addpath /opt/$USER/provision

# Add ccache to front of path
pathadd /usr/lib/ccache pre

# Locally installed stuff
pathadd ~/loca/bin
manpathadd ~/local/share/man

# Always stick my bin on the front of the path
pathadd ~/bin pre

# Ensure PATH and MANPATH are exported
export PATH LD_LIBRARY_PATH MANPATH

# Justone variables and paths
# Don't reprocess this if we're reloading
if [ ! $DOTFILES_RELOAD ]; then
    if [ -f /etc/justone_profile ]; then
	. /etc/justone_profile
    fi
fi

# Setup test directory for PostgreSQL JustOne tests
export PGTESTDIR=~/Test
if [ ! -d $PGTESTDIR ]; then
	mkdir $PGTESTDIR
fi

# Make
export MAKEFLAGS="-j$(expr $(grep processor /proc/cpuinfo | wc -l) / 2) V=0"

# Temp folder
export TMPDIR=/tmp/${USER:-$LOGNAME}
[[ ! -d $TMPDIR ]] && mkdir $TMPDIR

# Setup solarized dircolors
if [ -d $DOTFILES/externals/dircolors-solarized ]; then
	if [ -f $DOTFILES/externals/dircolors-solarized/dircolors.ansi-light ]; then
		eval `dircolors $DOTFILES/externals/dircolors-solarized/dircolors.ansi-light`
	fi
fi

# Java home
if [[ -z $JAVA_HOME ]]
then
	case `hostname` in
		iowa)
			export JAVA_HOME=/usr/lib/jvm/java-1.6.0-openjdk
			;;
		*)
			;;
	esac
fi

# Sensible file permissions by default
umask 022
